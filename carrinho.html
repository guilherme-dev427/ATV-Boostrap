<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TechStore - Carrinho</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            padding-top: 80px;
            background: #fff;
            color: #000;
        }

        .carrinho-container {
            max-width: 800px;
            margin: auto;
            padding: 2rem;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .carrinho-item {
            border-bottom: 1px solid #ccc;
            padding: 1rem 0;
        }

        .dark-mode {
            background-color: #121212;
            color: #f0f0f0;
        }

        .dark-mode .carrinho-container {
            background: #1e1e1e;
            color: #fff;
        }

        .dark-mode select,
        .dark-mode .btn,
        .dark-mode input {
            background-color: #333;
            color: #fff;
            border: 1px solid #555;
        }

        .btn-sm {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-laptop-code"></i> TechStore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="paginainicial.html">Pagina Inicial</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="login.html">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="produtos.html">Produtos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contato.html">Contato</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="localizacao.html">Localiza√ß√£o</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="carrinho.html">Carrinho üõí</a>
                    </li>
                    <button id="darkModeToggle" class="btn btn-outline-secondary ms-3">üåô</button>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <main class="carrinho-container">
            <h1 class="mb-4 text-center">üõí Seu Carrinho</h1>
            <div id="carrinho-lista"></div>
            <hr />
            <h3 class="text-end">Total: R$ <span id="total">0,00</span></h3>

            <div class="mt-4">
                <h5>üí≥ Parcelamento:</h5>
                <div class="d-flex align-items-center gap-2">
                    <label for="parcelas" class="form-label mb-0">Escolha parcelas:</label>
                    <select id="parcelas" class="form-select w-auto"></select>
                </div>
                <p id="valor-parcela" class="mt-2 text-muted">Selecione parcelas para simular o valor.</p>
            </div>

            <div class="mt-4">
                <h5>üí∞ Formas de Pagamento:</h5>
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-outline-primary" onclick="selecionarPagamento('Cart√£o')"><i
                            class="fas fa-credit-card"></i> Cart√£o</button>
                    <button class="btn btn-outline-success" onclick="selecionarPagamento('Pix')"><i
                            class="fas fa-qrcode"></i> Pix</button>
                    <button class="btn btn-outline-warning" onclick="selecionarPagamento('Boleto')"><i
                            class="fas fa-barcode"></i> Boleto</button>
                </div>
            </div>
            <div class="mt-4">
                <h5>üéüÔ∏è C√≥digo de Desconto:</h5>
                <input type="text" id="codigoDesconto" class="form-control w-auto d-inline-block"
                    placeholder="Digite o c√≥digo">
                <button class="btn btn-primary ms-2" onclick="aplicarDesconto()">Aplicar</button>
                <p id="mensagemDesconto" class="mt-2 text-success"></p>
            </div>

            <div class="text-end mt-4">
                <button class="btn btn-danger" onclick="limparCarrinho()">üóëÔ∏è Limpar Carrinho</button>
                <button class="btn btn-success" onclick="finalizarCompra()">‚úÖ Finalizar Compra</button>
            </div>
        </main>
    </div>

    <script>
        let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

        let descontoAtivo = 0;

        const cupons = {
            "techstore": 10,
            "iloverenan": 20,
            "iloverobson": 30,
        };

        function salvarCarrinho() {
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
        }

        function mostrarCarrinho() {
            const lista = document.getElementById("carrinho-lista");
            const totalEl = document.getElementById("total");
            lista.innerHTML = "";

            let total = 0;

            if (carrinho.length === 0) {
                lista.innerHTML = '<p class="text-center">Seu carrinho est√° vazio.</p>';
                totalEl.textContent = "0,00";
                atualizarParcelas(0);
                return;
            }

            carrinho.forEach((item, index) => {
                const subtotal = item.preco * item.quantidade;
                total += subtotal;

                const div = document.createElement("div");
                div.classList.add("carrinho-item", "d-flex", "justify-content-between", "align-items-center");
                div.innerHTML = `
            <div>
                <strong>${item.nome}</strong><br>
                <span>Pre√ßo unit√°rio: R$ ${item.preco.toFixed(2).replace(".", ",")}</span><br>
                <span>Qtd: ${item.quantidade}</span><br>
                <span>Subtotal: R$ ${subtotal.toFixed(2).replace(".", ",")}</span>
            </div>
            <div>
                <button class="btn btn-sm btn-outline-success me-1" onclick="aumentarQtd(${index})">+</button>
                <button class="btn btn-sm btn-outline-danger" onclick="removerItem(${index})">Remover</button>
            </div>
        `;
                lista.appendChild(div);
            });

            let totalComDesconto = total;
            if (descontoAtivo > 0) {
                totalComDesconto = total * (1 - descontoAtivo / 100);
            }

            totalEl.textContent = totalComDesconto.toFixed(2).replace(".", ",");

            atualizarParcelas(totalComDesconto);
        }

        function aumentarQtd(index) {
            carrinho[index].quantidade++;
            salvarCarrinho();
            mostrarCarrinho();
        }

        function removerItem(index) {
            carrinho.splice(index, 1);
            salvarCarrinho();
            mostrarCarrinho();
        }

        function limparCarrinho() {
            if (confirm("Tem certeza que quer limpar todo o carrinho?")) {
                carrinho = [];
                descontoAtivo = 0;
                document.getElementById('codigoDesconto').value = '';
                document.getElementById('mensagemDesconto').textContent = '';
                salvarCarrinho();
                mostrarCarrinho();
            }
        }

        function finalizarCompra() {
            if (carrinho.length === 0) {
                alert("Seu carrinho est√° vazio.");
                return;
            }
            alert(`Compra finalizada com sucesso!\nTotal pago: R$ ${document.getElementById("total").textContent}\nDesconto aplicado: ${descontoAtivo}%`);
            carrinho = [];
            descontoAtivo = 0;
            document.getElementById('codigoDesconto').value = '';
            document.getElementById('mensagemDesconto').textContent = '';
            salvarCarrinho();
            mostrarCarrinho();
        }

        function maxParcelasPorDesconto(desconto) {
            if (desconto >= 30) return 8;
            if (desconto >= 20) return 9;
            if (desconto >= 10) return 10;
            return 10;
        }

        function atualizarParcelas(total) {
            const select = document.getElementById("parcelas");
            const valorParcela = document.getElementById("valor-parcela");

            select.innerHTML = "";

            if (total === 0) {
                valorParcela.textContent = "Carrinho vazio.";
                return;
            }

            const maxParcelas = maxParcelasPorDesconto(descontoAtivo);

            for (let i = 1; i <= maxParcelas; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = `${i}x sem juros`;
                select.appendChild(option);
            }

            select.onchange = () => {
                const parcelas = parseInt(select.value);
                const valor = total / parcelas;
                valorParcela.textContent = `Voc√™ pagar√° ${parcelas}x de R$ ${valor.toFixed(2).replace(".", ",")}`;
            };

            select.value = 1;
            valorParcela.textContent = `Voc√™ pagar√° 1x de R$ ${total.toFixed(2).replace(".", ",")}`;
        }

        function selecionarPagamento(metodo) {
            alert(`Voc√™ selecionou pagamento via: ${metodo}`);
        }

        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem('modoEscuro', document.body.classList.contains('dark-mode'));
        }

        document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);

        // Aplica modo escuro salvo
        if (localStorage.getItem('modoEscuro') === 'true') {
            document.body.classList.add('dark-mode');
        }


        function aplicarDesconto() {
            const codigo = document.getElementById('codigoDesconto').value.trim().toLowerCase();
            const mensagem = document.getElementById('mensagemDesconto');

            if (codigo in cupons) {
                descontoAtivo = cupons[codigo];
                mensagem.textContent = `Desconto de ${descontoAtivo}% aplicado! üéâ`;
                mensagem.classList.remove('text-danger');
                mensagem.classList.add('text-success');
            } else {
                descontoAtivo = 0;
                mensagem.textContent = "C√≥digo inv√°lido ou expirado.";
                mensagem.classList.remove('text-success');
                mensagem.classList.add('text-danger');
            }

            mostrarCarrinho();
        }

        mostrarCarrinho();
    </script>
</body>

</html>